{% extends 'base.html.twig' %}

{% block title %}Administration - Utilisateurs{% endblock %}

{% block body %}
<div class="container mt-4">
  <h1 class="mb-3">Gestion des utilisateurs</h1>

  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>#</th>
          <th>Email</th>
          <th>Nom d’utilisateur</th>
          <th>Rôles</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
      {% for u in users %}
        <tr>
          <td>{{ u.id }}</td>
          <td>{{ u.email }}</td>
          <td>{{ u.username ?? '-' }}</td>
          <td>
            <form method="post" action="{{ path('admin_users_update_roles', { id: u.id }) }}" class="d-flex gap-3 align-items-center">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="role_author_{{ u.id }}" name="roles[]" value="ROLE_AUTHOR"
                       {{ 'ROLE_AUTHOR' in u.roles ? 'checked' : '' }} disabled>
                <label class="form-check-label" for="role_author_{{ u.id }}">ROLE_AUTHOR</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="role_admin_{{ u.id }}" name="roles[]" value="ROLE_ADMIN"
                       {{ 'ROLE_ADMIN' in u.roles ? 'checked' : '' }}>
                <label class="form-check-label" for="role_admin_{{ u.id }}">ROLE_ADMIN</label>
              </div>
              {# garantir ROLE_AUTHOR dans le POST (même si case désactivée) #}
              <input type="hidden" name="roles[]" value="ROLE_AUTHOR">
              <input type="hidden" name="_token" value="{{ csrf_token('update_user_roles_' ~ u.id) }}">
              <button class="btn btn-sm btn-outline-primary">Enregistrer</button>
            </form>
          </td>
          <td class="text-end">
            <form method="post"
                  action="{{ path('admin_users_delete', { id: u.id }) }}"
                  onsubmit="return confirm('Supprimer cet utilisateur ?');"
                  class="d-inline-block">
              <input type="hidden" name="_token" value="{{ csrf_token('delete_user_' ~ u.id) }}">
              <button class="btn btn-sm btn-outline-danger">Supprimer</button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="5" class="text-muted">Aucun utilisateur.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <a href="{{ path('app_home') }}" class="btn btn-link">← Retour</a>
</div>
{% endblock %}